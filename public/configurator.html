<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D-Konfigurator ‚Äì UNBREAK ONE</title>
    <meta name="description" content="Gestalten Sie Ihren individuellen UNBREAK ONE Weinglashalter im 3D-Konfigurator.">

    <!-- Stylesheets -->
    <link rel="stylesheet" href="/styles.css">
    <link rel="stylesheet" href="/animations.css">
    <link rel="stylesheet" href="/i18n.css">
    <link rel="stylesheet" href="/readability-optimization.css">
    <link rel="stylesheet" href="/configurator/configurator.css">

    <!-- i18n System -->
    <script src="/i18n.js?v=2.0.5"></script>
    <script src="/language-switch.js?v=2.0.5" defer></script>
    
    <!-- Bridge Communication System v2.0 -->
    <script src="/lib/bridge-schema.js?v=2.0.0"></script>
    <script src="/lib/bridge-debug.js?v=2.0.0"></script>
    <script src="/lib/bridge-debug-panel.js?v=2.0.0" defer></script>
    <script src="/iframe-language-bridge-v2.js?v=2.0.0" defer></script>
    
    <!-- CRITICAL: Test if JavaScript runs at all -->
    <script>
        console.log('üß™ [TEST] JavaScript IS executing!');
        console.log('üß™ [TEST] Window object exists:', typeof window);
        console.log('üß™ [TEST] Document ready state:', document.readyState);
        
        // Show deployment info for cache busting verification
        console.log('üîç [DEPLOY] Built at:', document.currentScript?.getAttribute('data-build-time') || 'unknown');
        console.log('üîç [DEPLOY] Commit:', '{{BUILD_HASH}}' || 'local');
    </script>
    
    <!-- Build Info Footer (for cache verification) -->
    <script>
        window.UNBREAK_BUILD_INFO = {
            timestamp: new Date().toISOString(),
            commit: 'bc16910',
            deployed: true
        };
    </script>
</head>

<body>

    <!-- DEBUG BAR (visible when ?debug=1) -->
    <div id="debug-bar" style="display: none; position: fixed; top: 0; left: 0; right: 0; background: #1e293b; color: #fff; padding: 8px 12px; z-index: 999999; font-family: monospace; font-size: 11px; border-bottom: 2px solid #0891b2;">
        <div style="display: flex; gap: 20px; flex-wrap: wrap; align-items: center;">
            <strong style="color: #0891b2;">üîß DEBUG MODE</strong>
            <span id="debug-iframe-loaded">iframe: <span style="color: #ef4444;">NO</span></span>
            <span id="debug-ready-received">ready: <span style="color: #ef4444;">NO</span></span>
            <span id="debug-last-config">lastConfig: <span style="color: #94a3b8;">none</span></span>
            <span id="debug-button-visible">button: <span style="color: #ef4444;">NO</span></span>
            <span id="debug-scroll">scroll: <span style="color: #94a3b8;">-</span></span>
            <button id="dump-diagnostics" style="background: #0891b2; color: white; border: none; padding: 4px 12px; border-radius: 4px; cursor: pointer; font-weight: bold;">Dump Diagnostics</button>
        </div>
    </div>

    <!-- Header / Navigation -->
    <header style="margin-top: 0;">
    <!-- Adjust for debug bar if active -->
        <nav>
            <div class="logo">
                <a href="index.html" class="logo-link">
                    <img src="images/logo.png" alt="UNBREAK ONE" class="nav-logo">
                </a>
            </div>

            <!-- Mobile Burger Menu -->
            <div class="burger-menu" id="burgerMenu">
                <span></span>
                <span></span>
                <span></span>
            </div>

            <ul class="nav-links" id="navLinks">
                <li><a href="index.html#product" data-i18n="nav.product">Produkt</a></li>
                <li><a href="index.html#use-cases" data-i18n="nav.useCases">Einsatzbereiche</a></li>
                <li><a href="index.html#tech" data-i18n="nav.tech">Technologie</a></li>
                <li><a href="index.html#how-to" data-i18n="nav.howTo">Anwendung</a></li>
                <li><a href="configurator.html" class="active" data-i18n="nav.configurator">Konfigurator</a></li>
                <li><a href="/shop" data-i18n="nav.shop">Shop</a></li>
                <li><a href="index.html#contact" data-i18n="nav.contact">Kontakt</a></li>
            </ul>
        </nav>
    </header>

    <!-- Configurator Section -->
    <section class="configurator-section">
        <div class="container">
            <div class="configurator-header">
                <h1 data-i18n="configurator.title">3D-Konfigurator</h1>
                <p data-i18n="configurator.subtitle">Gestalten Sie Ihren individuellen UNBREAK ONE Weinglashalter</p>
            </div>

            <div class="configurator-container">
                <!-- 3D Viewer - Vercel Integration -->
                <div class="viewer-wrapper-fullwidth">
                    <div class="cfgFrameOuter">
                        <iframe 
                            id="configurator-iframe"
                            src="https://unbreak-3-d-konfigurator.vercel.app/"
                            title="UNBREAK ONE 3D Konfigurator"
                            allow="accelerometer; autoplay; camera; encrypted-media; fullscreen; geolocation; gyroscope; magnetometer; microphone; midi; payment; vr; xr-spatial-tracking; web-share"
                            loading="eager"
                            allowfullscreen>
                        </iframe>
                    </div>
                    
                    <!-- Loading State -->
                    <div id="loading-overlay" class="loading-overlay">
                        <div class="loading-card">
                            <img src="images/logo.png" alt="UNBREAK ONE" class="loading-logo">
                            <div id="loading-spinner" class="loading-spinner"></div>
                            <p id="loading-text" class="loading-text" data-i18n="configurator.loading">Konfigurator wird geladen...</p>
                            <div id="loading-progress" class="loading-progress" style="display: none;">
                                <div class="progress-bar">
                                    <div id="progress-fill" class="progress-fill"></div>
                                </div>
                                <span id="progress-percent" class="progress-percent">0%</span>
                            </div>
                            <div id="error-container" class="error-container" style="display: none;">
                                <p id="error-message" class="error-message"></p>
                                <button id="reload-button" class="reload-button">Neu laden</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Debug Mode: Event Log (?debug=1 in URL) -->
                    <div id="debug-log" class="debug-log" style="display: none;">
                        <h4>Event Log</h4>
                        <div id="debug-events" class="debug-events"></div>
                        <button id="debug-clear" class="debug-clear-btn">Clear Log</button>
                    </div>
                </div>
            </div>
            
            <!-- Checkout Button (FORCED VISIBLE with !important) -->
            <div class="checkout-button-container" style="
                text-align: center !important; 
                margin: 3rem auto !important; 
                padding: 3rem 1rem !important;
                max-width: 800px !important;
                position: relative !important;
                z-index: 9999 !important;
                background: #f5f7fa !important;
                border-radius: 16px !important;
                box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1) !important;
                display: block !important;
                visibility: visible !important;
                opacity: 1 !important;
            ">
                <button 
                    id="configurator-buy-now-btn"
                    class="btn btn-primary btn-magnetic"
                    data-checkout="configured"
                    data-product-sku="UNBREAK-GLAS-01"
                    style="
                        padding: 1.5rem 4rem !important;
                        font-size: 1.4rem !important;
                        background: linear-gradient(135deg, #0891b2 0%, #0e7490 100%) !important;
                        color: white !important;
                        border: none !important;
                        border-radius: 12px !important;
                        cursor: pointer !important;
                        box-shadow: 0 8px 32px rgba(8, 145, 178, 0.3) !important;
                        transition: all 0.3s ease !important;
                        font-weight: 700 !important;
                        width: 100% !important;
                        max-width: 500px !important;
                        display: block !important;
                        margin: 0 auto !important;
                        visibility: visible !important;
                        opacity: 1 !important;
                        position: relative !important;
                        z-index: 10000 !important;
                    " 
                    onmouseover="this.style.transform='translateY(-4px)'; this.style.boxShadow='0 16px 48px rgba(8, 145, 178, 0.5)';"
                    onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 8px 32px rgba(8, 145, 178, 0.3)';">
                    üõí Jetzt kaufen
                </button>
                <p style="
                    margin-top: 1.5rem !important;
                    color: #333 !important;
                    font-size: 1rem !important;
                    font-weight: 500 !important;
                ">
                    ‚ú® Konfiguration wird beim Klick √ºbernommen
                </p>
            </div>

            <!-- Info Section -->
            <div class="configurator-info">
                <div class="info-card">
                    <h4 data-i18n="configurator.infoMaterialTitle">Premium-Material</h4>
                    <p data-i18n="configurator.infoMaterialText">Hochwertige Verarbeitung aus robustem Material f√ºr langlebigen Halt.</p>
                </div>
                <div class="info-card">
                    <h4 data-i18n="configurator.infoDeliveryTitle">Schnelle Lieferung</h4>
                    <p data-i18n="configurator.infoDeliveryText">Ihre Bestellung wird innerhalb von 3-5 Tagen bearbeitet und versendet.</p>
                </div>
                <div class="info-card">
                    <h4 data-i18n="configurator.infoCustomTitle">Individuell</h4>
                    <p data-i18n="configurator.infoCustomText">Jedes St√ºck wird nach Ihren W√ºnschen gefertigt.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer>
        <div class="container">
            <p style="margin: 0.5rem 0; color: #666; font-size: 11px; font-family: monospace;">
                üîß Build: <strong>bc16910</strong> ‚Ä¢ Deployed: <span id="deploy-time"></span> ‚Ä¢
                <a href="#" onclick="location.reload(true); return false;" style="color: #0891b2; text-decoration: underline;">Hard Refresh</a>
            </p>
            <p>&copy; 2024 UNBREAK ONE. Alle Rechte vorbehalten.</p>
            <p>
                <a href="impressum.html" data-i18n="footer.imprint">Impressum</a> |
                <a href="datenschutz.html" data-i18n="footer.privacy">Datenschutz</a> |
                <a href="agb.html" data-i18n="footer.terms">AGB</a>
            </p>
        </div>
        <script>
            document.getElementById('deploy-time').textContent = new Date().toLocaleTimeString('de-DE');
        </script>
    </footer>

    <!-- Scripts - CRITICAL ORDER: Bridge MUST load before configurator-new.js -->
    <script src="animations.js"></script>
    <script src="script.js"></script>
    <script src="configurator/trace-system.js"></script>
    
    <!-- PERSISTENT DEBUG PANEL (loads first if debug=1) -->
    <script>
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.get('debug') === '1') {
            const script = document.createElement('script');
            script.src = 'lib/debugPanel.js';
            document.head.appendChild(script);
            console.log('[DEBUG] Persistent Debug Panel loading...');
            
            // MESSAGE TAP: Log ALL postMessages (even blocked ones)
            window.addEventListener('message', function(event) {
                const ts = Date.now();
                const data = event.data;
                
                // Always log to console for reference
                console.log('[MESSAGE_TAP]', {
                    timestamp: new Date(ts).toISOString().substring(11, 23),
                    origin: event.origin,
                    type: data?.type || 'no-type',
                    data: data
                });
                
                // Check if blocked by origin filter
                const ALLOWED_ORIGINS = [
                    'https://unbreak-3-d-konfigurator.vercel.app',
                    window.location.origin
                ];
                
                const isBlocked = !ALLOWED_ORIGINS.includes(event.origin);
                
                if (window.UnbreakDebugPanel) {
                    if (isBlocked) {
                        window.UnbreakDebugPanel.logBlocked(
                            event.origin,
                            `Not in allowlist: ${ALLOWED_ORIGINS.join(', ')}`
                        );
                    } else if (data && data.type) {
                        // Determine direction
                        const isFromIframe = event.origin === 'https://unbreak-3-d-konfigurator.vercel.app';
                        window.UnbreakDebugPanel.logMessage(
                            data.type,
                            isFromIframe ? 'from' : 'to',
                            data.message || '',
                            data
                        );
                    }
                }
            }, true); // Use capture phase
            
            console.log('[MESSAGE_TAP] Installed - all postMessages will be logged');
        }
    </script>
    
    <!-- CRITICAL: Load bridge first -->
    <script src="lib/configuratorBridge.js"></script>
    <script>
        // IMMEDIATE VERIFICATION
        console.log('[BRIDGE_CHECK] window.ConfiguratorBridge exists:', !!window.ConfiguratorBridge);
        console.log('[BRIDGE_CHECK] typeof:', typeof window.ConfiguratorBridge);
        console.log('[BRIDGE_CHECK] is constructor:', typeof window.ConfiguratorBridge === 'function');
        if (!window.ConfiguratorBridge) {
            console.error('‚ùå FATAL: ConfiguratorBridge not loaded! Script path broken.');
            if (window.UnbreakDebugPanel) {
                window.UnbreakDebugPanel.logError('ConfiguratorBridge not loaded', 'script-loader', 'Check lib/configuratorBridge.js path');
            }
        }
    </script>
    
    <script src="checkout.js"></script>
    <script src="configurator/configurator-new.js"></script>
    
    <!-- DEBUG MODE CONTROLLER -->
    <script>
    (function() {
        // Check if debug mode enabled
        const urlParams = new URLSearchParams(window.location.search);
        const debugMode = urlParams.get('debug') === '1';
        
        if (!debugMode) return;
        
        console.log('üîß [DEBUG MODE] Enabled - Failure-safe diagnostics active');
        console.log('[DEBUG_INIT] URL:', window.location.href);
        console.log('[DEBUG_INIT] Build:', window.UNBREAK_BUILD_INFO || 'unknown');
        
        // Show debug bar IMMEDIATELY (no dependencies)
        const debugBar = document.getElementById('debug-bar');
        if (debugBar) {
            debugBar.style.display = 'block';
            document.body.style.marginTop = '40px';
        }
        
        // State tracking
        const state = {
            iframeLoaded: false,
            readyReceived: false,
            lastConfigTs: null,
            lastConfigVariant: null,
            buttonVisible: false,
            bridgeLogs: []
        };
        
        // Update debug display
        function updateDebug() {
            const iframe = document.getElementById('configurator-iframe');
            const button = document.getElementById('configurator-buy-now-btn');
            
            // Check iframe loaded
            state.iframeLoaded = iframe && iframe.contentWindow != null;
            document.querySelector('#debug-iframe-loaded span').textContent = state.iframeLoaded ? 'YES' : 'NO';
            document.querySelector('#debug-iframe-loaded span').style.color = state.iframeLoaded ? '#10b981' : '#ef4444';
            
            // Check ready
            const bridge = window.ConfiguratorBridge;
            state.readyReceived = bridge && bridge.isReady && bridge.isReady();
            document.querySelector('#debug-ready-received span').textContent = state.readyReceived ? 'YES' : 'NO';
            document.querySelector('#debug-ready-received span').style.color = state.readyReceived ? '#10b981' : '#ef4444';
            
            // Check config
            const lastConfig = bridge && bridge.lastConfig;
            if (lastConfig) {
                state.lastConfigTs = Date.now();
                state.lastConfigVariant = lastConfig.variant;
                const ago = state.lastConfigTs ? Math.round((Date.now() - state.lastConfigTs) / 1000) : 0;
                document.querySelector('#debug-last-config span').textContent = `${state.lastConfigVariant} (${ago}s ago)`;
                document.querySelector('#debug-last-config span').style.color = '#10b981';
            } else {
                document.querySelector('#debug-last-config span').textContent = 'none';
                document.querySelector('#debug-last-config span').style.color = '#94a3b8';
            }
            
            // Check button visible
            state.buttonVisible = button && button.offsetParent !== null;
            document.querySelector('#debug-button-visible span').textContent = state.buttonVisible ? 'YES' : 'NO';
            document.querySelector('#debug-button-visible span').style.color = state.buttonVisible ? '#10b981' : '#ef4444';
            
            // Check scroll container
            const container = document.querySelector('.checkout-button-container');
            if (container) {
                const rect = container.getBoundingClientRect();
                const inView = rect.top < window.innerHeight && rect.bottom > 0;
                document.querySelector('#debug-scroll span').textContent = inView ? 'in-view' : `${Math.round(rect.top)}px below`;
                document.querySelector('#debug-scroll span').style.color = inView ? '#10b981' : '#f59e0b';
            }
        }
        
        // Update every 500ms
        setInterval(updateDebug, 500);
        
        // Intercept bridge logs
        const originalLog = console.log;
        console.log = function(...args) {
            if (args[0] && typeof args[0] === 'string' && args[0].includes('[UNBREAK_PARENT]')) {
                state.bridgeLogs.push({
                    ts: Date.now(),
                    msg: args.join(' ')
                });
                if (state.bridgeLogs.length > 30) state.bridgeLogs.shift();
            }
            originalLog.apply(console, args);
        };
        
        // WATCHDOG: Detect stalled loading
        let loadingStartTime = Date.now();
        let isStalled = false;
        setTimeout(function() {
            const loadingOverlay = document.getElementById('loading-overlay');
            if (loadingOverlay && !loadingOverlay.classList.contains('hidden')) {
                isStalled = true;
                console.error('[3D_LOAD_STALLED] Still loading after 10s', {
                    trace_id: 'stall_' + Date.now(),
                    stalled_ms: Date.now() - loadingStartTime,
                    overlay_visible: true,
                    last_error: window._lastConsoleError || 'none'
                });
                
                // Add STALLED badge to debug bar
                const stalledBadge = document.createElement('span');
                stalledBadge.textContent = 'üî¥ STALLED';
                stalledBadge.style.cssText = 'color: #ef4444; font-weight: bold; animation: pulse 1s infinite;';
                document.getElementById('debug-bar').appendChild(stalledBadge);
            }
        }, 10000);
        
        // Capture console errors
        window._lastConsoleError = null;
        const originalError = console.error;
        console.error = function(...args) {
            window._lastConsoleError = args.join(' ');
            originalError.apply(console, args);
        };
        
        // Dump diagnostics button (ALWAYS ENABLED)
        document.getElementById('dump-diagnostics').addEventListener('click', function() {
            console.log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê');
            console.log('üîç DIAGNOSTIC DUMP (FAILURE-SAFE)');
            console.log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê');
            console.log('Timestamp:', new Date().toISOString());
            console.log('Stalled:', isStalled);
            console.log('Loading duration:', Date.now() - loadingStartTime, 'ms');
            
            // URL + Build
            console.log('\nüìç ENVIRONMENT:');
            console.log('- URL:', window.location.href);
            console.log('- Pathname:', window.location.pathname);
            console.log('- Is configurator.html:', window.location.pathname.includes('configurator.html'));
            console.log('- Build info:', window.UNBREAK_BUILD_INFO);
            console.log('- Last console error:', window._lastConsoleError || 'none');
            
            // 1. All buy button candidates
            console.log('\nüìç BUY BUTTON ELEMENTS:');
            const byDataAttr = document.querySelectorAll('[data-checkout]');
            const byId = document.getElementById('configurator-buy-now-btn');
            const byText = Array.from(document.querySelectorAll('button')).filter(b => b.textContent.includes('kaufen'));
            
            console.log('- By [data-checkout]:', byDataAttr.length, byDataAttr);
            console.log('- By ID #configurator-buy-now-btn:', byId);
            console.log('- By text "kaufen":', byText.length, byText);
            
            if (byId) {
                const rect = byId.getBoundingClientRect();
                console.log('  Button rect:', rect);
                console.log('  Visible (offsetParent):', byId.offsetParent !== null);
                console.log('  Computed display:', getComputedStyle(byId).display);
                console.log('  Computed visibility:', getComputedStyle(byId).visibility);
                console.log('  Z-index:', getComputedStyle(byId).zIndex);
            }
            
            // 2. Iframe details + loading status
            console.log('\nüìç IFRAME:');
            const iframe = document.getElementById('configurator-iframe');
            if (iframe) {
                const rect = iframe.getBoundingClientRect();
                console.log('- Element:', iframe);
                console.log('- Src:', iframe.src);
                console.log('- Rect:', rect);
                console.log('- contentWindow exists:', !!iframe.contentWindow);
                console.log('- readyState:', iframe.contentDocument?.readyState || 'no access');
                console.log('- onload fired:', iframe._onloadFired || false);
            } else {
                console.log('- IFRAME NOT FOUND');
            }
            
            const loadingOverlay = document.getElementById('loading-overlay');
            console.log('- Loading overlay visible:', loadingOverlay && !loadingOverlay.classList.contains('hidden'));
            console.log('- Loading overlay classes:', loadingOverlay?.className);
            
            // 3. Overlays covering button
            console.log('\nüìç POTENTIAL OVERLAYS (z-index > 1000):');
            const allElements = document.querySelectorAll('*');
            const highZIndex = Array.from(allElements).filter(el => {
                const z = parseInt(getComputedStyle(el).zIndex);
                return z > 1000;
            });
            console.log('- Count:', highZIndex.length);
            highZIndex.forEach(el => {
                console.log(`  - ${el.tagName}#${el.id}.${el.className} z=${getComputedStyle(el).zIndex}`);
            });
            
            // 4. Container overflow
            console.log('\nüìç SCROLL CONTAINERS:');
            const body = document.body;
            const main = document.querySelector('main');
            const container = document.querySelector('.checkout-button-container');
            
            console.log('- body overflow:', getComputedStyle(body).overflow, 'height:', getComputedStyle(body).height);
            if (main) console.log('- main overflow:', getComputedStyle(main).overflow, 'height:', getComputedStyle(main).height);
            if (container) {
                console.log('- .checkout-button-container:', getComputedStyle(container).overflow, 'height:', getComputedStyle(container).height);
                console.log('  Rect:', container.getBoundingClientRect());
            }
            
            // 5. Bridge logs
            console.log('\nüìç LAST 30 BRIDGE LOGS:');
            state.bridgeLogs.forEach(log => {
                console.log(`  ${new Date(log.ts).toISOString().substr(11, 12)} ${log.msg}`);
            });
            
            // 6. Bridge state
            console.log('\nüìç BRIDGE STATE:');
            const bridge = window.ConfiguratorBridge;
            if (bridge) {
                console.log('- Exists:', true);
                console.log('- isReady:', bridge.isReady ? bridge.isReady() : 'no method');
                console.log('- lastConfig:', bridge.lastConfig);
            } else {
                console.log('- Exists:', false);
            }
            
            // 7. WebGL capability
            console.log('\nüìç WEBGL:');
            const canvas = document.createElement('canvas');
            const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
            if (gl) {
                const debugInfo = gl.getExtension('WEBGL_debug_renderer_info');
                console.log('- WebGL supported:', true);
                console.log('- Vendor:', gl.getParameter(gl.VENDOR));
                console.log('- Renderer:', debugInfo ? gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL) : 'N/A');
                console.log('- Version:', gl.getParameter(gl.VERSION));
            } else {
                console.log('- WebGL supported:', false, '‚ùå THIS IS THE PROBLEM');
            }
            
            // 8. Network requests (if available)
            console.log('\nüìç NETWORK (from Performance API):');
            const resources = performance.getEntriesByType('resource');
            const modelAssets = resources.filter(r => 
                r.name.includes('.glb') || 
                r.name.includes('.gltf') || 
                r.name.includes('draco') ||
                r.name.includes('ktx2') ||
                r.name.includes('vercel.app')
            );
            console.log('- Total resources loaded:', resources.length);
            console.log('- 3D-related assets:', modelAssets.length);
            modelAssets.forEach(asset => {
                console.log(`  - ${asset.name}`);
                console.log(`    Duration: ${asset.duration}ms, Size: ${asset.transferSize || 'unknown'} bytes`);
            });
            
            console.log('\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê');
        });
        
        // Track iframe onload
        const iframe = document.getElementById('configurator-iframe');
        if (iframe) {
            iframe.addEventListener('load', function() {
                console.log('[3D_IFRAME_LOADED] onload event fired');
                this._onloadFired = true;
            });
        }
    })();
    </script>
    
    <!-- DEBUG: Button visibility check -->
    <script>
    console.log('üîç [DEBUG] Checking button visibility...');
    window.addEventListener('DOMContentLoaded', () => {
        setTimeout(() => {
            const btn = document.getElementById('configurator-buy-now-btn');
            if (btn) {
                const rect = btn.getBoundingClientRect();
                const isVisible = rect.top < window.innerHeight;
                console.log('‚úÖ [DEBUG] Button exists!');
                console.log('üìè [DEBUG] Button position:', {
                    top: rect.top,
                    bottom: rect.bottom,
                    windowHeight: window.innerHeight,
                    isVisibleInViewport: isVisible
                });
                console.log('üé® [DEBUG] Button computed styles:', {
                    display: window.getComputedStyle(btn).display,
                    visibility: window.getComputedStyle(btn).visibility,
                    opacity: window.getComputedStyle(btn).opacity,
                    zIndex: window.getComputedStyle(btn).zIndex
                });
                
                // Add visible marker above button
                const marker = document.createElement('div');
                marker.style.cssText = `
                    position: fixed;
                    top: 10px;
                    right: 10px;
                    background: #10b981;
                    color: white;
                    padding: 10px 20px;
                    border-radius: 8px;
                    font-weight: bold;
                    z-index: 99999;
                    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                `;
                marker.textContent = '‚úÖ Button ist im DOM!';
                document.body.appendChild(marker);
                
                if (!isVisible) {
                    marker.textContent = '‚ö†Ô∏è Button existiert, aber nicht im Viewport - bitte scrollen!';
                    marker.style.background = '#f59e0b';
                }
            } else {
                console.error('‚ùå [DEBUG] Button NOT found in DOM!');
                const errorMarker = document.createElement('div');
                errorMarker.style.cssText = `
                    position: fixed;
                    top: 10px;
                    right: 10px;
                    background: #ef4444;
                    color: white;
                    padding: 10px 20px;
                    border-radius: 8px;
                    font-weight: bold;
                    z-index: 99999;
                `;
                errorMarker.textContent = '‚ùå Button NICHT im DOM!';
                document.body.appendChild(errorMarker);
            }
        }, 1000);
    });
    </script>
    
    <!-- Legacy RELAY Handler - Now handled by Bridge v2.0 -->
    <script>
    // NOTE: This is now handled by iframe-language-bridge-v2.js
    // Keeping minimal fallback for old iframe format during migration
    console.log('üîß [LEGACY_RELAY] Loaded (Bridge v2.0 handles most cases)');
    </script>

</body>

</html>
                console.log('‚úÖ [RELAY] Config relayed to checkout.js');
            }
            // Special handling for error messages that might contain config
            else if (data.type === 'UNBREAK_CONFIG_ERROR') {
                console.log('‚ö†Ô∏è [RELAY] Error message received, checking for config in payload...');
                
                // Some iframes send config even in error payload
                if (data.payload && typeof data.payload === 'object') {
                    console.log('üì¶ [RELAY] Payload exists:', data.payload);
                    
                    // Try to use default config
                    const fallbackConfig = {
                        product_name: 'UNBREAK ONE',
                        product_variant: 'glass_holder',
                        colors: { selected: 'petrol' },
                    };
                    
                    console.log('üì¶ [RELAY] Using fallback config after error');
                    
                    window.postMessage({
                        type: 'checkout_configuration',
                        ...fallbackConfig
                    }, window.location.origin);
                }
            } else if (cfg) {
                console.log('‚ÑπÔ∏è [RELAY] Config found but no add_to_cart action, storing in bridge');
                // Let ConfiguratorBridge handle config updates
            } else {
                console.log('‚ÑπÔ∏è [RELAY] No config found in message, ignoring');
            }
        }
    }, true); // Use capture phase to catch before other handlers
    
    console.log('‚úÖ [RELAY] Direct relay listener attached');
    </script>

</body>

</html>
